<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PixelCity Utforsker</title>
    <style>
        /* CSS - Utseende og Layout */
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #1a1a1a;
            font-family: 'Courier New', Courier, monospace;
            color: #fff;
            overflow: hidden;
            touch-action: none;
        }

        #game-wrapper {
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border: 4px solid #333;
        }

        canvas {
            display: block;
            image-rendering: pixelated; /* Beholder pikslene skarpe */
            background-color: #2d5a27;
        }

        #ui-layer {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px;
            border-radius: 4px;
            pointer-events: none;
            border: 1px solid #555;
        }

        .stat { margin-bottom: 5px; color: #ffcc00; font-weight: bold; }

        /* Pil-kontroller nede i hjÃ¸rnet */
        #d-pad {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: grid;
            grid-template-columns: repeat(3, 65px);
            grid-template-rows: repeat(2, 65px);
            gap: 8px;
        }

        .btn {
            width: 65px;
            height: 65px;
            background: #444;
            border: 3px solid #666;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            border-radius: 8px;
            user-select: none;
            box-shadow: 0 4px 0 #222;
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #222;
            background: #555;
        }

        #up { grid-column: 2; }
        #left { grid-column: 1; grid-row: 2; }
        #down { grid-column: 2; grid-row: 2; }
        #right { grid-column: 3; grid-row: 2; }

        /* KjÃ¸pe-knapp */
        #shop-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 15px 25px;
            background: #e67e22;
            border: 3px solid #d35400;
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
            box-shadow: 0 4px 0 #a04000;
        }

        #shop-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #a04000;
        }
    </style>
</head>
<body>

<div id="game-wrapper">
    <div id="ui-layer">
        <div class="stat">Mynter: <span id="coin-count">0</span></div>
        <div class="stat">Vei-deler: <span id="road-count">1</span></div>
    </div>
    <canvas id="cityCanvas"></canvas>
</div>

<button id="shop-btn">BYGG MER VEI (10 ðŸª™)</button>

<div id="d-pad">
    <div class="btn" id="up">â–²</div>
    <div class="btn" id="left">â—€</div>
    <div class="btn" id="down">â–¼</div>
    <div class="btn" id="right">â–¶</div>
</div>

<script>
    /* JAVASCRIPT - Spillogikk */
    const canvas = document.getElementById('cityCanvas');
    const ctx = canvas.getContext('2d');
    const coinEl = document.getElementById('coin-count');
    const roadEl = document.getElementById('road-count');

    // Instillinger for spillverden
    const tileSize = 32;
    const gridDim = 12; // 12x12 ruter
    canvas.width = tileSize * gridDim;
    canvas.height = tileSize * gridDim;

    let coins = 0;
    let roadParts = 1;

    // Kart-data: 0 = Gress/Hus, 1 = Vei, 2 = Mynt
    let grid = [];
    function initGrid() {
        for(let y=0; y<gridDim; y++) {
            grid[y] = [];
            for(let x=0; x<gridDim; x++) {
                grid[y][x] = 0; 
            }
        }
        // Start-veier (et kryss i midten)
        for(let i=0; i<gridDim; i++) {
            grid[5][i] = 1;
            grid[i][5] = 1;
        }
        spawnCoin();
    }

    // Spiller-posisjon
    let player = { x: 5, y: 5 };

    function spawnCoin() {
        let placed = false;
        while(!placed) {
            let rx = Math.floor(Math.random() * gridDim);
            let ry = Math.floor(Math.random() * gridDim);
            // Mynt kan bare spawne pÃ¥ vei (type 1)
            if(grid[ry][rx] === 1) {
                grid[ry][rx] = 2;
                placed = true;
            }
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for(let y=0; y<gridDim; y++) {
            for(let x=0; x<gridDim; x++) {
                let cell = grid[y][x];
                
                // Tegn bakken/gress
                ctx.fillStyle = "#2d5a27";
                ctx.fillRect(x*tileSize, y*tileSize, tileSize, tileSize);

                if(cell === 0) {
                    // Tegn smÃ¥ hus eller busker
                    ctx.fillStyle = "#4a3728";
                    ctx.fillRect(x*tileSize+6, y*tileSize+6, tileSize-12, tileSize-12);
                } else if(cell >= 1) {
                    // Tegn vei
                    ctx.fillStyle = "#555";
                    ctx.fillRect(x*tileSize, y*tileSize, tileSize, tileSize);
                    // Vei-markering
                    ctx.fillStyle = "#777";
                    ctx.fillRect(x*tileSize+14, y*tileSize, 4, tileSize);
                }

                if(cell === 2) {
                    // Tegn mynt
                    ctx.fillStyle = "#ffd700";
                    ctx.beginPath();
                    ctx.arc(x*tileSize + tileSize/2, y*tileSize + tileSize/2, 6, 0, Math.PI*2);
                    ctx.fill();
                }
            }
        }

        // Tegn spiller (den lille personen)
        ctx.fillStyle = "#e74c3c"; // RÃ¸d person
        ctx.fillRect(player.x * tileSize + 8, player.y * tileSize + 4, tileSize - 16, tileSize - 10);
        ctx.fillStyle = "#ffdbac"; // Hudfarge hode
        ctx.fillRect(player.x * tileSize + 10, player.y * tileSize + 2, tileSize - 20, 8);
    }

    function move(dx, dy) {
        let nextX = player.x + dx;
        let nextY = player.y + dy;

        // Sjekk om innenfor brettet
        if(nextX >= 0 && nextX < gridDim && nextY >= 0 && nextY < gridDim) {
            // Sjekk om det er vei (type 1 eller 2)
            if(grid[nextY][nextX] >= 1) {
                player.x = nextX;
                player.y = nextY;

                // Sjekk mynt-oppsamling
                if(grid[player.y][player.x] === 2) {
                    grid[player.y][player.x] = 1;
                    coins++;
                    coinEl.innerText = coins;
                    spawnCoin();
                }
                draw();
            }
        }
    }

    document.getElementById('shop-btn').onclick = () => {
        if(coins >= 10) {
            coins -= 10;
            roadParts++;
            coinEl.innerText = coins;
            roadEl.innerText = roadParts;

            // Legg til en ny tilfeldig vei-linje
            let isVertical = Math.random() > 0.5;
            let pos = Math.floor(Math.random() * (gridDim - 2)) + 1;
            
            for(let i=0; i<gridDim; i++) {
                if(isVertical) grid[i][pos] = 1;
                else grid[pos][i] = 1;
            }
            // SÃ¸rg for at det alltid er en mynt tilgjengelig
            spawnCoin();
            draw();
        } else {
            alert("Du trenger 10 mynter for Ã¥ utvide byen!");
        }
    };

    // Knapp-kontrollere
    document.getElementById('up').onclick = () => move(0, -1);
    document.getElementById('down').onclick = () => move(0, 1);
    document.getElementById('left').onclick = () => move(-1, 0);
    document.getElementById('right').onclick = () => move(1, 0);

    // Tastatur-stÃ¸tte
    window.addEventListener('keydown', (e) => {
        switch(e.key) {
            case "ArrowUp": move(0, -1); break;
            case "ArrowDown": move(0, 1); break;
            case "ArrowLeft": move(-1, 0); break;
            case "ArrowRight": move(1, 0); break;
        }
    });

    // Start spillet
    initGrid();
    draw();
</script>

</body>
</html>
