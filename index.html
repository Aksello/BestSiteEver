<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pixel City Expansion</title>
    <style>
        :root {
            --ui-bg: rgba(20, 20, 25, 0.95);
            --accent: #f1c40f;
            --road: #3d3d3d;
        }

        body {
            margin: 0;
            background-color: #111;
            color: white;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            overflow: hidden;
            touch-action: none; /* Stopper all zooming og scrolling */
            user-select: none;
        }

        #game-wrapper {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        canvas {
            image-rendering: pixelated;
            border: 4px solid #333;
            background-color: #27ae60;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        #hud {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--ui-bg);
            padding: 15px;
            border-radius: 12px;
            border-left: 6px solid var(--accent);
            min-width: 120px;
        }

        .stat-val { font-size: 24px; font-weight: 800; color: var(--accent); }
        .stat-label { font-size: 10px; text-transform: uppercase; opacity: 0.7; }

        /* Styring */
        #controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: grid;
            grid-template-columns: repeat(3, 80px);
            grid-template-rows: repeat(2, 80px);
            gap: 15px;
        }

        .btn {
            width: 80px;
            height: 80px;
            background: #2c3e50;
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 6px 0 #1a252f;
        }

        .btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #1a252f;
        }

        #up { grid-column: 2; }
        #left { grid-column: 1; grid-row: 2; }
        #down { grid-column: 2; grid-row: 2; }
        #right { grid-column: 3; grid-row: 2; }

        #buy-area {
            position: fixed;
            bottom: 30px;
            left: 30px;
        }

        #buy-btn {
            padding: 20px 40px;
            background: #e67e22;
            border: none;
            color: white;
            font-weight: bold;
            border-radius: 15px;
            box-shadow: 0 6px 0 #a04000;
            cursor: pointer;
            font-size: 18px;
        }

        #buy-btn:active:not(:disabled) {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #a04000;
        }

        #buy-btn:disabled {
            background: #555;
            box-shadow: 0 6px 0 #333;
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>

<div id="game-wrapper">
    <canvas id="cityCanvas"></canvas>
</div>

<div id="hud">
    <div class="stat-label">Mynter</div>
    <div class="stat-val" id="coin-txt">0</div>
    <div style="height: 10px;"></div>
    <div class="stat-label">By-StÃ¸rrelse</div>
    <div class="stat-val" id="size-txt">10x10</div>
</div>

<div id="buy-area">
    <button id="buy-btn" onclick="expandCity()">UTVID BYEN (10 ðŸª™)</button>
</div>

<div id="controls">
    <div class="btn" id="up">â–²</div>
    <div class="btn" id="left">â—€</div>
    <div class="btn" id="down">â–¼</div>
    <div class="btn" id="right">â–¶</div>
</div>

<script>
    const canvas = document.getElementById('cityCanvas');
    const ctx = canvas.getContext('2d');

    // Spillinnstillinger
    const TILE_SIZE = 50;
    let gridDim = 10; 
    let grid = [];
    let coins = 0;
    let player = { x: 2, y: 2 };
    
    // Kamera-innstillinger
    const viewSize = 600; 
    canvas.width = viewSize;
    canvas.height = viewSize;

    function initGrid(dim) {
        let newGrid = Array(dim).fill().map(() => Array(dim).fill(0));
        // Behold gamle data hvis de finnes
        for(let y=0; y<grid.length; y++) {
            for(let x=0; x<grid[y].length; x++) {
                newGrid[y][x] = grid[y][x];
            }
        }
        grid = newGrid;
        
        // Legg til veier i de nye omrÃ¥dene
        for(let i=0; i<dim; i++) {
            grid[2][i] = grid[2][i] || 1;
            grid[i][2] = grid[i][2] || 1;
            // Legg til en ekstra tilfeldig hovedvei for hver ekspansjon
            if (dim > 10 && i % 8 === 0) {
                for(let j=0; j<dim; j++) grid[i][j] = 1;
            }
        }
        spawnCoin();
    }

    function spawnCoin() {
        let roadTiles = [];
        for(let y=0; y<gridDim; y++) {
            for(let x=0; x<gridDim; x++) {
                if(grid[y][x] === 1) roadTiles.push({x, y});
            }
        }
        if(roadTiles.length > 0) {
            let pos = roadTiles[Math.floor(Math.random() * roadTiles.length)];
            grid[pos.y][pos.x] = 2;
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Kamera-offset (sentrer pÃ¥ spiller)
        const offsetX = (viewSize / 2) - (player.x * TILE_SIZE) - (TILE_SIZE / 2);
        const offsetY = (viewSize / 2) - (player.y * TILE_SIZE) - (TILE_SIZE / 2);

        for(let y=0; y<gridDim; y++) {
            for(let x=0; x<gridDim; x++) {
                const tx = x * TILE_SIZE + offsetX;
                const ty = y * TILE_SIZE + offsetY;

                // Tegn kun hvis det er innenfor canvas for ytelse
                if (tx < -TILE_SIZE || tx > viewSize || ty < -TILE_SIZE || ty > viewSize) continue;

                // 1. GRESS
                ctx.fillStyle = "#27ae60";
                ctx.fillRect(tx, ty, TILE_SIZE, TILE_SIZE);
                ctx.fillStyle = "#2ecc71";
                ctx.fillRect(tx+10, ty+10, 4, 4); // Blomst/gress-strÃ¥

                if(grid[y][x] === 0) {
                    // 2. HUS (Bedre grafikk)
                    ctx.fillStyle = "#2c3e50"; // Skygge
                    ctx.fillRect(tx+8, ty+12, TILE_SIZE-16, TILE_SIZE-16);
                    ctx.fillStyle = "#ecf0f1"; // Vegg
                    ctx.fillRect(tx+8, ty+8, TILE_SIZE-16, TILE_SIZE-20);
                    ctx.fillStyle = "#e74c3c"; // Tak
                    ctx.beginPath();
                    ctx.moveTo(tx+8, ty+8); ctx.lineTo(tx+TILE_SIZE/2, ty+2); ctx.lineTo(tx+TILE_SIZE-8, ty+8);
                    ctx.fill();
                    // Vindu
                    ctx.fillStyle = "#f1c40f";
                    ctx.fillRect(tx+12, ty+14, 6, 6);
                } else {
                    // 3. VEI
                    ctx.fillStyle = "#333";
                    ctx.fillRect(tx, ty, TILE_SIZE, TILE_SIZE);
                    
                    // Vei-detaljer (kantlinjer)
                    ctx.strokeStyle = "#444";
                    ctx.strokeRect(tx+2, ty+2, TILE_SIZE-4, TILE_SIZE-4);

                    // Midtstripe (hvis det er vei ved siden av)
                    ctx.fillStyle = "#555";
                    if(grid[y][x+1]) ctx.fillRect(tx + TILE_SIZE-10, ty + TILE_SIZE/2 - 2, 10, 4);
                    if(grid[y+1] && grid[y+1][x]) ctx.fillRect(tx + TILE_SIZE/2 - 2, ty + TILE_SIZE-10, 4, 10);
                }

                if(grid[y][x] === 2) {
                    // 4. MYNT (Glitrende)
                    ctx.fillStyle = "#f1c40f";
                    const s = Math.sin(Date.now() / 200) * 5;
                    ctx.beginPath();
                    ctx.arc(tx + TILE_SIZE/2, ty + TILE_SIZE/2, 10 + s/2, 0, Math.PI*2);
                    ctx.fill();
                }
            }
        }

        // SPILLER
        const px = (viewSize / 2) - (TILE_SIZE / 2);
        const py = (viewSize / 2) - (TILE_SIZE / 2);
        
        ctx.fillStyle = "#3498db"; // Kropp
        ctx.fillRect(px+10, py+15, 30, 30);
        ctx.fillStyle = "#f3dbc2"; // Hode
        ctx.fillRect(px+15, py+5, 20, 20);
        ctx.fillStyle = "#222"; // Ã˜yne
        ctx.fillRect(px+20, py+12, 3, 3); ctx.fillRect(px+27, py+12, 3, 3);

        requestAnimationFrame(draw);
    }

    function move(dx, dy) {
        let nx = player.x + dx;
        let ny = player.y + dy;

        if(nx >= 0 && nx < gridDim && ny >= 0 && ny < gridDim) {
            if(grid[ny][nx] >= 1) {
                player.x = nx;
                player.y = ny;

                if(grid[ny][nx] === 2) {
                    grid[ny][nx] = 1;
                    coins++;
                    updateUI();
                    spawnCoin();
                }
            }
        }
    }

    function expandCity() {
        if(coins >= 10) {
            coins -= 10;
            gridDim += 5; // Utvid kartet med 5 ruter i begge retninger
            initGrid(gridDim);
            updateUI();
        }
    }

    function updateUI() {
        document.getElementById('coin-txt').innerText = coins;
        document.getElementById('size-txt').innerText = `${gridDim}x${gridDim}`;
        document.getElementById('buy-btn').disabled = coins < 10;
    }

    // Input-hÃ¥ndtering
    const dirs = { 'up': [0, -1], 'down': [0, 1], 'left': [-1, 0], 'right': [1, 0] };
    Object.keys(dirs).forEach(id => {
        const btn = document.getElementById(id);
        const handler = (e) => { e.preventDefault(); move(...dirs[id]); };
        btn.addEventListener('touchstart', handler);
        btn.addEventListener('mousedown', handler);
    });

    window.addEventListener('keydown', (e) => {
        if(e.key === "ArrowUp") move(0, -1);
        if(e.key === "ArrowDown") move(0, 1);
        if(e.key === "ArrowLeft") move(-1, 0);
        if(e.key === "ArrowRight") move(1, 0);
    });

    initGrid(gridDim);
    draw();
</script>

</body>
</html>
